pipeline{

agent {
label 'k8_master'
}

stages{

stage('Hello world'){
steps{
echo "Hello World"
}
}

stage('scm repo'){
steps{
git url :'https://github.com/naveenmenda/website.git',branch:'master'
}
}
stage('build the docker file'){
steps{
sh 'sudo docker build /home/ubuntu/jenkins/workspace/project2 -t naveen1406/webapp'

}
}
stage('dokcerhub login and push'){
steps{
withCredentials([string(credentialsId: 'Dockerhub', variable: 'Dockerhub')]) {
sh 'sudo docker login -u naveen1406 -p ${Dockerhub}'
sh 'sudo docker push naveen1406/webapp'
}
}
}
stage('deploy k8 master'){
steps{
sh 'kubectl apply -f deploy.yml'
}
}
}
}

